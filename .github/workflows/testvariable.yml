on: issue_comment
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v6
        id: test
        with:
          script: |
            return 421094206
      - name: getWorkflowId
        id: workflowid
        run: |
          curl "https://api.github.com/repos/SaillantNicolas/cgal-web/actions/artifacts/${{ steps.test.outputs.result }}" -o artifact.json
          echo "::set-output name=id::$(cat artifact.json | jq -r '.workflow_run.id')"
      - name: githuboutput
        id: testoutput
        run: echo "DoxygenError=No package affected." >> $GITHUB_OUTPUT
      - name: copy
        id: testenv
        run: |
          delimiter="$(openssl rand -hex 8)"
          echo "DoxygenError<<${delimiter}" >> "${GITHUB_OUTPUT}"
          cat artifact.json >> "${GITHUB_OUTPUT}"
          echo "${delimiter}" >> "${GITHUB_OUTPUT}"
          exit 1
      - name: paste
        run: echo "${{ steps.testenv.outputs.DoxygenError}}"

      - name: getPrId
        id: prid
        run: |
          curl "https://api.github.com/repos/SaillantNicolas/cgal-web/actions/runs/${{ steps.workflowid.outputs.id }}" -o workflow.json
          echo "::set-output name=id::$(cat workflow.json | jq -r '.pull_requests[0].id')"
      - run: echo ${{ steps.prid.outputs.id }}
      - name: Post error
        uses: actions/github-script@v6
        if: ${{ failure() && steps.get_round.outputs.result != 'stop' }}
        with:
          script: |
            const error = "${{steps.testenv.outputs.DoxygenError}}"
            const msg = "There was an error while building the doc: \n"+`error`
            github.rest.issues.createComment({
              owner: "CGAL",
              repo: "cgal",
              issue_number: ${{ github.event.issue.number }},
              body: msg
            });
